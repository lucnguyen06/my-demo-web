// Sản phẩm mẫu
class Product {
  constructor(id, name, price, image, desc, category) {
    this.id = id;
    this.name = name;
    this.price = price;
    this.image = image;
    this.desc = desc;
    this.category = category;
  }
}
[
  {
    "id": 1,
    "name": "Giày cầu lông Taro TR024-2",
    "price": 499000,
    "image": "giay_taro_tr024_2.jpg",
    "description": "Giày cầu lông Taro TR024-2, thiết kế thể thao, êm ái, bám sân tốt.",
    "category": "Giày"
  },
  {
    "id": 2,
    "name": "Giày cầu lông Taro TR024-1",
    "price": 499000,
    "image": "giay_taro_tr024_1.jpg",
    "description": "Giày cầu lông Taro TR024-1, kiểu dáng trẻ trung, phù hợp mọi đối tượng.",
    "category": "Giày"
  },
  {
    "id": 3,
    "name": "Sản phẩm mẫu 3",
    "price": 1003000,
    "image": "images/san_pham_3.jpg",
    "description": "Mô tả sản phẩm mẫu 3.",
    "category": "Giày"
  },
  {
    "id": 4,
    "name": "Sản phẩm mẫu 4",
    "price": 1004000,
    "image": "images/san_pham_4.jpg",
    "description": "Mô tả sản phẩm mẫu 4.",
    "category": "Vợt"
  },
  {
    "id": 5,
    "name": "Sản phẩm mẫu 5",
    "price": 1005000,
    "image": "images/san_pham_5.jpg",
    "description": "Mô tả sản phẩm mẫu 5.",
    "category": "Giày"
  },
  {
    "id": 6,
    "name": "Sản phẩm mẫu 6",
    "price": 1006000,
    "image": "images/san_pham_6.jpg",
    "description": "Mô tả sản phẩm mẫu 6.",
    "category": "Vợt"
  },
  {
    "id": 7,
    "name": "Sản phẩm mẫu 7",
    "price": 1007000,
    "image": "images/san_pham_7.jpg",
    "description": "Mô tả sản phẩm mẫu 7.",
    "category": "Giày"
  },
  {
    "id": 8,
    "name": "Sản phẩm mẫu 8",
    "price": 1008000,
    "image": "images/san_pham_8.jpg",
    "description": "Mô tả sản phẩm mẫu 8.",
    "category": "Vợt"
  },
  {
    "id": 9,
    "name": "Sản phẩm mẫu 9",
    "price": 1009000,
    "image": "images/san_pham_9.jpg",
    "description": "Mô tả sản phẩm mẫu 9.",
    "category": "Giày"
  },
  {
    "id": 10,
    "name": "Sản phẩm mẫu 10",
    "price": 1010000,
    "image": "images/san_pham_10.jpg",
    "description": "Mô tả sản phẩm mẫu 10.",
    "category": "Vợt"
  },
  {
    "id": 11,
    "name": "Sản phẩm mẫu 11",
    "price": 1011000,
    "image": "images/san_pham_11.jpg",
    "description": "Mô tả sản phẩm mẫu 11.",
    "category": "Giày"
  },
  {
    "id": 12,
    "name": "Sản phẩm mẫu 12",
    "price": 1012000,
    "image": "images/san_pham_12.jpg",
    "description": "Mô tả sản phẩm mẫu 12.",
    "category": "Vợt"
  },
  {
    "id": 13,
    "name": "Sản phẩm mẫu 13",
    "price": 1013000,
    "image": "images/san_pham_13.jpg",
    "description": "Mô tả sản phẩm mẫu 13.",
    "category": "Giày"
  },
  {
    "id": 14,
    "name": "Sản phẩm mẫu 14",
    "price": 1014000,
    "image": "images/san_pham_14.jpg",
    "description": "Mô tả sản phẩm mẫu 14.",
    "category": "Vợt"
  },
  {
    "id": 15,
    "name": "Sản phẩm mẫu 15",
    "price": 1015000,
    "image": "images/san_pham_15.jpg",
    "description": "Mô tả sản phẩm mẫu 15.",
    "category": "Giày"
  },
  {
    "id": 16,
    "name": "Sản phẩm mẫu 16",
    "price": 1016000,
    "image": "images/san_pham_16.jpg",
    "description": "Mô tả sản phẩm mẫu 16.",
    "category": "Vợt"
  },
  {
    "id": 17,
    "name": "Sản phẩm mẫu 17",
    "price": 1017000,
    "image": "images/san_pham_17.jpg",
    "description": "Mô tả sản phẩm mẫu 17.",
    "category": "Giày"
  },
  {
    "id": 18,
    "name": "Sản phẩm mẫu 18",
    "price": 1018000,
    "image": "images/san_pham_18.jpg",
    "description": "Mô tả sản phẩm mẫu 18.",
    "category": "Vợt"
  },
  {
    "id": 19,
    "name": "Sản phẩm mẫu 19",
    "price": 1019000,
    "image": "images/san_pham_19.jpg",
    "description": "Mô tả sản phẩm mẫu 19.",
    "category": "Giày"
  },
  {
    "id": 20,
    "name": "Sản phẩm mẫu 20",
    "price": 1020000,
    "image": "images/san_pham_20.jpg",
    "description": "Mô tả sản phẩm mẫu 20.",
    "category": "Vợt"
  },
  {
    "id": 21,
    "name": "Sản phẩm mẫu 21",
    "price": 1021000,
    "image": "images/san_pham_21.jpg",
    "description": "Mô tả sản phẩm mẫu 21.",
    "category": "Giày"
  },
  {
    "id": 22,
    "name": "Sản phẩm mẫu 22",
    "price": 1022000,
    "image": "images/san_pham_22.jpg",
    "description": "Mô tả sản phẩm mẫu 22.",
    "category": "Vợt"
  },
  {
    "id": 23,
    "name": "Sản phẩm mẫu 23",
    "price": 1023000,
    "image": "images/san_pham_23.jpg",
    "description": "Mô tả sản phẩm mẫu 23.",
    "category": "Giày"
  },
  {
    "id": 24,
    "name": "Sản phẩm mẫu 24",
    "price": 1024000,
    "image": "images/san_pham_24.jpg",
    "description": "Mô tả sản phẩm mẫu 24.",
    "category": "Vợt"
  },
  {
    "id": 25,
    "name": "Sản phẩm mẫu 25",
    "price": 1025000,
    "image": "images/san_pham_25.jpg",
    "description": "Mô tả sản phẩm mẫu 25.",
    "category": "Giày"
  },
  {
    "id": 26,
    "name": "Sản phẩm mẫu 26",
    "price": 1026000,
    "image": "images/san_pham_26.jpg",
    "description": "Mô tả sản phẩm mẫu 26.",
    "category": "Vợt"
  },
  {
    "id": 27,
    "name": "Sản phẩm mẫu 27",
    "price": 1027000,
    "image": "images/san_pham_27.jpg",
    "description": "Mô tả sản phẩm mẫu 27.",
    "category": "Giày"
  },
  {
    "id": 28,
    "name": "Sản phẩm mẫu 28",
    "price": 1028000,
    "image": "images/san_pham_28.jpg",
    "description": "Mô tả sản phẩm mẫu 28.",
    "category": "Vợt"
  },
  {
    "id": 29,
    "name": "Sản phẩm mẫu 29",
    "price": 1029000,
    "image": "images/san_pham_29.jpg",
    "description": "Mô tả sản phẩm mẫu 29.",
    "category": "Giày"
  },
  {
    "id": 30,
    "name": "Sản phẩm mẫu 30",
    "price": 1030000,
    "image": "images/san_pham_30.jpg",
    "description": "Mô tả sản phẩm mẫu 30.",
    "category": "Vợt"
  },
  {
    "id": 31,
    "name": "Sản phẩm mẫu 31",
    "price": 1031000,
    "image": "images/san_pham_31.jpg",
    "description": "Mô tả sản phẩm mẫu 31.",
    "category": "Giày"
  },
  {
    "id": 32,
    "name": "Sản phẩm mẫu 32",
    "price": 1032000,
    "image": "images/san_pham_32.jpg",
    "description": "Mô tả sản phẩm mẫu 32.",
    "category": "Vợt"
  },
  {
    "id": 33,
    "name": "Sản phẩm mẫu 33",
    "price": 1033000,
    "image": "images/san_pham_33.jpg",
    "description": "Mô tả sản phẩm mẫu 33.",
    "category": "Giày"
  },
  {
    "id": 34,
    "name": "Sản phẩm mẫu 34",
    "price": 1034000,
    "image": "images/san_pham_34.jpg",
    "description": "Mô tả sản phẩm mẫu 34.",
    "category": "Vợt"
  },
  {
    "id": 35,
    "name": "Sản phẩm mẫu 35",
    "price": 1035000,
    "image": "images/san_pham_35.jpg",
    "description": "Mô tả sản phẩm mẫu 35.",
    "category": "Giày"
  },
  {
    "id": 36,
    "name": "Sản phẩm mẫu 36",
    "price": 1036000,
    "image": "images/san_pham_36.jpg",
    "description": "Mô tả sản phẩm mẫu 36.",
    "category": "Vợt"
  },
  {
    "id": 37,
    "name": "Sản phẩm mẫu 37",
    "price": 1037000,
    "image": "images/san_pham_37.jpg",
    "description": "Mô tả sản phẩm mẫu 37.",
    "category": "Giày"
  },
  {
    "id": 38,
    "name": "Sản phẩm mẫu 38",
    "price": 1038000,
    "image": "images/san_pham_38.jpg",
    "description": "Mô tả sản phẩm mẫu 38.",
    "category": "Vợt"
  },
  {
    "id": 39,
    "name": "Sản phẩm mẫu 39",
    "price": 1039000,
    "image": "images/san_pham_39.jpg",
    "description": "Mô tả sản phẩm mẫu 39.",
    "category": "Giày"
  },
  {
    "id": 40,
    "name": "Sản phẩm mẫu 40",
    "price": 1040000,
    "image": "images/san_pham_40.jpg",
    "description": "Mô tả sản phẩm mẫu 40.",
    "category": "Vợt"
  },
  {
    "id": 41,
    "name": "Sản phẩm mẫu 41",
    "price": 1041000,
    "image": "images/san_pham_41.jpg",
    "description": "Mô tả sản phẩm mẫu 41.",
    "category": "Giày"
  },
  {
    "id": 42,
    "name": "Sản phẩm mẫu 42",
    "price": 1042000,
    "image": "images/san_pham_42.jpg",
    "description": "Mô tả sản phẩm mẫu 42.",
    "category": "Vợt"
  },
  {
    "id": 43,
    "name": "Sản phẩm mẫu 43",
    "price": 1043000,
    "image": "images/san_pham_43.jpg",
    "description": "Mô tả sản phẩm mẫu 43.",
    "category": "Giày"
  },
  {
    "id": 44,
    "name": "Sản phẩm mẫu 44",
    "price": 1044000,
    "image": "images/san_pham_44.jpg",
    "description": "Mô tả sản phẩm mẫu 44.",
    "category": "Vợt"
  },
  {
    "id": 45,
    "name": "Sản phẩm mẫu 45",
    "price": 1045000,
    "image": "images/san_pham_45.jpg",
    "description": "Mô tả sản phẩm mẫu 45.",
    "category": "Giày"
  },
  {
    "id": 46,
    "name": "Sản phẩm mẫu 46",
    "price": 1046000,
    "image": "images/san_pham_46.jpg",
    "description": "Mô tả sản phẩm mẫu 46.",
    "category": "Vợt"
  },
  {
    "id": 47,
    "name": "Sản phẩm mẫu 47",
    "price": 1047000,
    "image": "images/san_pham_47.jpg",
    "description": "Mô tả sản phẩm mẫu 47.",
    "category": "Giày"
  },
  {
    "id": 48,
    "name": "Sản phẩm mẫu 48",
    "price": 1048000,
    "image": "images/san_pham_48.jpg",
    "description": "Mô tả sản phẩm mẫu 48.",
    "category": "Vợt"
  },
  {
    "id": 49,
    "name": "Sản phẩm mẫu 49",
    "price": 1049000,
    "image": "images/san_pham_49.jpg",
    "description": "Mô tả sản phẩm mẫu 49.",
    "category": "Giày"
  },
  {
    "id": 50,
    "name": "Sản phẩm mẫu 50",
    "price": 1050000,
    "image": "images/san_pham_50.jpg",
    "description": "Mô tả sản phẩm mẫu 50.",
    "category": "Vợt"
  },
  {
    "id": 51,
    "name": "Sản phẩm mẫu 51",
    "price": 1051000,
    "image": "images/san_pham_51.jpg",
    "description": "Mô tả sản phẩm mẫu 51.",
    "category": "Giày"
  },
  {
    "id": 52,
    "name": "Sản phẩm mẫu 52",
    "price": 1052000,
    "image": "images/san_pham_52.jpg",
    "description": "Mô tả sản phẩm mẫu 52.",
    "category": "Vợt"
  },
  {
    "id": 53,
    "name": "Sản phẩm mẫu 53",
    "price": 1053000,
    "image": "images/san_pham_53.jpg",
    "description": "Mô tả sản phẩm mẫu 53.",
    "category": "Giày"
  },
  {
    "id": 54,
    "name": "Sản phẩm mẫu 54",
    "price": 1054000,
    "image": "images/san_pham_54.jpg",
    "description": "Mô tả sản phẩm mẫu 54.",
    "category": "Vợt"
  },
  {
    "id": 55,
    "name": "Sản phẩm mẫu 55",
    "price": 1055000,
    "image": "images/san_pham_55.jpg",
    "description": "Mô tả sản phẩm mẫu 55.",
    "category": "Giày"
  },
  {
    "id": 56,
    "name": "Sản phẩm mẫu 56",
    "price": 1056000,
    "image": "images/san_pham_56.jpg",
    "description": "Mô tả sản phẩm mẫu 56.",
    "category": "Vợt"
  },
  {
    "id": 57,
    "name": "Sản phẩm mẫu 57",
    "price": 1057000,
    "image": "images/san_pham_57.jpg",
    "description": "Mô tả sản phẩm mẫu 57.",
    "category": "Giày"
  },
  {
    "id": 58,
    "name": "Sản phẩm mẫu 58",
    "price": 1058000,
    "image": "images/san_pham_58.jpg",
    "description": "Mô tả sản phẩm mẫu 58.",
    "category": "Vợt"
  },
  {
    "id": 59,
    "name": "Sản phẩm mẫu 59",
    "price": 1059000,
    "image": "images/san_pham_59.jpg",
    "description": "Mô tả sản phẩm mẫu 59.",
    "category": "Giày"
  },
  {
    "id": 60,
    "name": "Sản phẩm mẫu 60",
    "price": 1060000,
    "image": "images/san_pham_60.jpg",
    "description": "Mô tả sản phẩm mẫu 60.",
    "category": "Vợt"
  },
  {
    "id": 61,
    "name": "Sản phẩm mẫu 61",
    "price": 1061000,
    "image": "images/san_pham_61.jpg",
    "description": "Mô tả sản phẩm mẫu 61.",
    "category": "Giày"
  },
  {
    "id": 62,
    "name": "Sản phẩm mẫu 62",
    "price": 1062000,
    "image": "images/san_pham_62.jpg",
    "description": "Mô tả sản phẩm mẫu 62.",
    "category": "Vợt"
  },
  {
    "id": 63,
    "name": "Sản phẩm mẫu 63",
    "price": 1063000,
    "image": "images/san_pham_63.jpg",
    "description": "Mô tả sản phẩm mẫu 63.",
    "category": "Giày"
  },
  {
    "id": 64,
    "name": "Sản phẩm mẫu 64",
    "price": 1064000,
    "image": "images/san_pham_64.jpg",
    "description": "Mô tả sản phẩm mẫu 64.",
    "category": "Vợt"
  },
  {
    "id": 65,
    "name": "Sản phẩm mẫu 65",
    "price": 1065000,
    "image": "images/san_pham_65.jpg",
    "description": "Mô tả sản phẩm mẫu 65.",
    "category": "Giày"
  },
  {
    "id": 66,
    "name": "Sản phẩm mẫu 66",
    "price": 1066000,
    "image": "images/san_pham_66.jpg",
    "description": "Mô tả sản phẩm mẫu 66.",
    "category": "Vợt"
  },
  {
    "id": 67,
    "name": "Sản phẩm mẫu 67",
    "price": 1067000,
    "image": "images/san_pham_67.jpg",
    "description": "Mô tả sản phẩm mẫu 67.",
    "category": "Giày"
  },
  {
    "id": 68,
    "name": "Sản phẩm mẫu 68",
    "price": 1068000,
    "image": "images/san_pham_68.jpg",
    "description": "Mô tả sản phẩm mẫu 68.",
    "category": "Vợt"
  },
  {
    "id": 69,
    "name": "Sản phẩm mẫu 69",
    "price": 1069000,
    "image": "images/san_pham_69.jpg",
    "description": "Mô tả sản phẩm mẫu 69.",
    "category": "Giày"
  },
  {
    "id": 70,
    "name": "Sản phẩm mẫu 70",
    "price": 1070000,
    "image": "images/san_pham_70.jpg",
    "description": "Mô tả sản phẩm mẫu 70.",
    "category": "Vợt"
  },
  {
    "id": 71,
    "name": "Sản phẩm mẫu 71",
    "price": 1071000,
    "image": "images/san_pham_71.jpg",
    "description": "Mô tả sản phẩm mẫu 71.",
    "category": "Giày"
  },
  {
    "id": 72,
    "name": "Sản phẩm mẫu 72",
    "price": 1072000,
    "image": "images/san_pham_72.jpg",
    "description": "Mô tả sản phẩm mẫu 72.",
    "category": "Vợt"
  },
  {
    "id": 73,
    "name": "Sản phẩm mẫu 73",
    "price": 1073000,
    "image": "images/san_pham_73.jpg",
    "description": "Mô tả sản phẩm mẫu 73.",
    "category": "Giày"
  },
  {
    "id": 74,
    "name": "Sản phẩm mẫu 74",
    "price": 1074000,
    "image": "images/san_pham_74.jpg",
    "description": "Mô tả sản phẩm mẫu 74.",
    "category": "Vợt"
  },
  {
    "id": 75,
    "name": "Sản phẩm mẫu 75",
    "price": 1075000,
    "image": "images/san_pham_75.jpg",
    "description": "Mô tả sản phẩm mẫu 75.",
    "category": "Giày"
  }
]

// Hiển thị sản phẩm
let currentCategory = 'Tất cả';
function filterCategory(cat) {
  currentCategory = cat;
  renderProducts();
}

function renderProducts() {
  const container = document.getElementById('products');
  let filtered = products;
  if (currentCategory !== 'Tất cả') {
    filtered = products.filter(p => p.category === currentCategory);
  }
  container.innerHTML = filtered.map(p => `
    <div class="product" onmouseover="showDetail(${p.id})" onmouseout="hideDetail(${p.id})">
      <img src="${p.image}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p>${p.price.toLocaleString()} VNĐ</p>
      <button onclick="addToCart(${p.id})">Thêm vào giỏ</button>
      <div class="detail" id="detail-${p.id}" style="display:none">${p.desc}</div>
    </div>
  `).join('');
}

function showDetail(id) {
  document.getElementById('detail-' + id).style.display = 'block';
}
function hideDetail(id) {
  document.getElementById('detail-' + id).style.display = 'none';
}

// Giỏ hàng đơn giản lưu localStorage
function addToCart(id) {
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');
  const prod = products.find(p => p.id === id);
  const found = cart.find(item => item.id === id);
  if (found) found.qty++;
  else cart.push({ ...prod, qty: 1 });
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount();
  alert('Đã thêm vào giỏ!');
}

function updateCartCount() {
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');
  document.getElementById('cart-count').innerText = cart.reduce((s, i) => s + i.qty, 0);
}

function showCart() {
  renderCart();
  document.getElementById('cart-modal').style.display = 'flex';
}
function hideCart() {
  document.getElementById('cart-modal').style.display = 'none';
}

function renderCart() {
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');
  const cartDiv = document.getElementById('cart');
  if (!cart.length) {
    cartDiv.innerHTML = '<p>Giỏ hàng trống.</p>';
    return;
  }
  let total = 0;
  cartDiv.innerHTML = `
    <table style="margin:0 auto; border-collapse:collapse; min-width:350px;">
      <tr style="background:#e6f7ff;"><th>Sản phẩm</th><th>Giá</th><th>Số lượng</th><th>Thành tiền</th><th>Xóa</th></tr>
      ${cart.map((item, i) => {
        const thanhTien = item.price * item.qty;
        total += thanhTien;
        return `<tr>
          <td>${item.name}</td>
          <td>${item.price.toLocaleString()} VNĐ</td>
          <td><input type='number' min='1' value='${item.qty}' onchange='updateQty(${item.id}, this.value)' style='width:50px'></td>
          <td>${thanhTien.toLocaleString()} VNĐ</td>
          <td><button onclick='removeItem(${item.id})'>Xóa</button></td>
        </tr>`;
      }).join('')}
      <tr style="font-weight:bold;"><td colspan="3">Tổng cộng</td><td colspan="2">${total.toLocaleString()} VNĐ</td></tr>
    </table>
  `;
}

function updateQty(id, qty) {
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');
  const item = cart.find(i => i.id === id);
  if (item) {
    item.qty = Math.max(1, parseInt(qty));
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCart();
    updateCartCount();
  }
}

function removeItem(id) {
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');
  cart = cart.filter(i => i.id !== id);
  localStorage.setItem('cart', JSON.stringify(cart));
  renderCart();
  updateCartCount();
}

// Slider đơn giản
const sliderImages = [
  'images/baned_1.jpg',
  'images/baned_2.jpg',
  'images/baned_3.jpg',
  'images/baned_4.jpg',
  'images/baned_5.jpg',
  'images/baned_6.jpg',
  'images/baned_7.jpg',
];
let sliderIndex = 0;
let sliderTimer = null;
function renderSlider() {
  const slider = document.getElementById('slider');
  slider.innerHTML = `
    <img src="${sliderImages[sliderIndex]}" class="slider-img">
    <button onclick="prevSlide()">&#10094;</button>
    <button onclick="nextSlide()">&#10095;</button>
  `;
  if (sliderTimer) clearTimeout(sliderTimer);
  sliderTimer = setTimeout(() => {
    sliderIndex = (sliderIndex + 1) % sliderImages.length;
    renderSlider();
  }, 3000);
}
function prevSlide() {
  sliderIndex = (sliderIndex - 1 + sliderImages.length) % sliderImages.length;
  renderSlider();
}
function nextSlide() {
  sliderIndex = (sliderIndex + 1) % sliderImages.length;
  renderSlider();
}

// Countdown clock cho flash sale
function startCountdown() {
  // Kiểm tra localStorage đã có thời gian kết thúc chưa
  let end = localStorage.getItem('flashsale_end');
  if (!end) {
    // Nếu chưa có, thiết lập thời gian kết thúc mới (2 tiếng từ bây giờ)
    end = Date.now() + 2 * 60 * 60 * 1000;
    localStorage.setItem('flashsale_end', end);
  } else {
    end = parseInt(end);
  }
  function update() {
    const now = Date.now();
    let diff = Math.max(0, end - now);
    const h = Math.floor(diff / 3600000);
    diff %= 3600000;
    const m = Math.floor(diff / 60000);
    diff %= 60000;
    const s = Math.floor(diff / 1000);
    document.getElementById('countdown').innerHTML =
      `<b>Flash Sale:</b> còn ${h}h ${m}m ${s}s!`;
    if (end - now > 0) setTimeout(update, 1000);
    else localStorage.removeItem('flashsale_end');
  }
  update();
}

window.onload = function() {
  renderSlider();
  renderProducts();
  startCountdown();
  updateCartCount();
}; 
window.prevSlide = prevSlide;
window.nextSlide = nextSlide; 
